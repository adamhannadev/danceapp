<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) ? "#{content_for(:title)} | " : "" %>Ballroom Dancing CRM</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    
    <!-- Font Awesome (external dependency) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="d-flex flex-column min-vh-100">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-ballroom">
      <div class="container">
        <%= link_to root_path, class: "navbar-brand" do %>
          <i class="fas fa-music me-2"></i>
          <strong>AHBD</strong>
        <% end %>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <% if user_signed_in? %>
              <li class="nav-item">
                <%= link_to root_path, class: "nav-link #{'active' if current_page?(root_path)}" do %>
                  <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                <% end %>
              </li>
              <% if current_user.admin? || current_user.instructor? %>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-users me-1"></i>People
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to users_path, class: "dropdown-item" do %>
                    <i class="fas fa-user-graduate me-2"></i>Students
                  <% end %></li>
                  <li><%= link_to users_path(role: 'instructor'), class: "dropdown-item" do %>
                    <i class="fas fa-chalkboard-teacher me-2"></i>Instructors
                  <% end %></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><%= link_to new_user_path, class: "dropdown-item" do %>
                    <i class="fas fa-user-plus me-2"></i>Add New Person
                  <% end %></li>
                </ul>
              </li>
              <% end %>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle #{'active' if ['dance_classes', 'figures'].include?(controller_name)}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-music me-1"></i>Lessons
                </a>
                <ul class="dropdown-menu">
                  <!-- <li><%= link_to dance_classes_path, class: "dropdown-item" do %>
                    <i class="fas fa-calendar-alt me-2"></i>Dance Classes
                  <% end %></li>           -->
                <li class="nav-item">
                <%= link_to private_lessons_path, class: "dropdown-item" do %>
                  <i class="fas fa-user-graduate me-1"></i>Private Lessons
                <% end %>
              </li>
              <li class="nav-item">
                <%= link_to routines_path, class: "dropdown-item" do %>
                  <i class="fas fa-list-alt me-1"></i>Routines
                <% end %>
              </li>         
                </ul> 
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle #{'active' if controller_name == 'student_progress'}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-chart-line me-1"></i>Progress
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to student_progress_index_path, class: "dropdown-item" do %>
                    <i class="fas fa-user me-2"></i>My Progress
                  <% end %></li>
                  <% if current_user&.admin? || current_user&.instructor? %>
                    <li><hr class="dropdown-divider"></li>
                    <li><%= link_to all_students_student_progress_index_path, class: "dropdown-item" do %>
                      <i class="fas fa-users me-2"></i>All Students
                    <% end %></li>
                  <% end %>
                </ul>
              </li>
                            <% if current_user&.instructor? || current_user&.admin? %>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle #{'active' if controller_name == 'instructor_availabilities'}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-calendar-check me-1"></i>Instructor Tools
                  </a>
                  <ul class="dropdown-menu">
                    <li><%= link_to user_availabilities_path(current_user), class: "dropdown-item" do %>
                      <i class="fas fa-calendar-alt me-2"></i>My Availability
                    <% end %></li>
                  <li><%= link_to figures_path, class: "dropdown-item" do %>
                    <i class="fas fa-step-forward me-2"></i>Figures & Steps
                  <% end %></li>
                    <% if current_user&.admin? %>
                      <li><hr class="dropdown-divider"></li>
                      <li class="dropdown-header">All Instructors</li>
                      <% User.instructors.each do |instructor| %>
                        <li><%= link_to user_availabilities_path(instructor), class: "dropdown-item" do %>
                          <i class="fas fa-user me-2"></i><%= instructor.full_name %>
                        <% end %></li>
                      <% end %>
                    <% end %>
                  </ul>
                </li>
              <% end %>
              <!--
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-ellipsis-h me-1"></i>More
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to "#", class: "dropdown-item" do %>
                    <i class="fas fa-calendar me-2"></i>Schedule
                  <% end %></li>
                  <li><%= link_to "#", class: "dropdown-item" do %>
                    <i class="fas fa-trophy me-2"></i>Competitions
                  <% end %></li>
                  <li><%= link_to "#", class: "dropdown-item" do %>
                    <i class="fas fa-money-bill-wave me-2"></i>Billing
                  <% end %></li>
                  <% if current_user&.admin? %>
                    <li><hr class="dropdown-divider"></li>
                    <li><%= link_to users_path, class: "dropdown-item" do %>
                      <i class="fas fa-users-cog me-2"></i>Manage Users
                    <% end %></li>
                  <% end %>
                </ul>
              </li>
            <% end %>
            -->
          </ul>
          
          <ul class="navbar-nav">
            <% if user_signed_in? %>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-user-circle me-1"></i>
                  <%= current_user.full_name %>
                  <span class="badge bg-light text-dark ms-2"><%= current_user.role.humanize %></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><%= link_to edit_user_registration_path, class: "dropdown-item" do %>
                    <i class="fas fa-user me-2"></i>Edit Profile
                  <% end %></li>
                  <li><%= link_to user_path(current_user), class: "dropdown-item" do %>
                    <i class="fas fa-eye me-2"></i>View Profile
                  <% end %></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><%= link_to destroy_user_session_path, class: "dropdown-item", data: { "turbo-method": :delete } do %>
                    <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                  <% end %></li>
                </ul>
              </li>
            <% else %>
              <li class="nav-item">
                <%= link_to new_user_session_path, class: "nav-link" do %>
                  <i class="fas fa-sign-in-alt me-1"></i>Sign In
                <% end %>
              </li>
              <li class="nav-item">
                <%= link_to new_user_registration_path, class: "nav-link" do %>
                  <i class="fas fa-user-plus me-1"></i>Sign Up
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Main Content -->
        <main class="flex-fill">
      <!-- Flash Messages -->
      <% flash.each do |type, message| %>
        <div class="position-fixed top-0 start-50 translate-middle-x w-100 d-flex justify-content-center" style="z-index: 9999; padding-top: 20px;">
          <div class="alert alert-<%= flash_class(type) %> alert-dismissible fade show" role="alert" style="position: relative; z-index: 9999; max-width: 600px;">
            <i class="<%= flash_icon(type) %> me-2"></i>
            <%= message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        </div>
      <% end %>
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="bg-purple-gradient text-white py-4 mt-auto">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h5 class="mb-0">
              <i class="fas fa-music me-2"></i>
              Ballroom Dancing CRM
            </h5>
            <small class="opacity-75">Elegance in Motion, Excellence in Management</small>
          </div>
          <div class="col-md-6 text-md-end">
            <small class="opacity-75">
              © <%= Date.current.year %> Built with ❤️ for AHBD
            </small>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
