<% content_for :title, @dance_class.name %>

<div class="page-header-ballroom">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1><i class="fas fa-music me-3"></i><%= @dance_class.name %></h1>
        <p class="lead mb-0">
          <%= @dance_class.dance_style.name %> â€¢ <%= @dance_class.dance_level.name %>
        </p>
      </div>
      <div class="col-md-4 text-end">
        <div class="btn-group" role="group">
          <%= link_to edit_dance_class_path(@dance_class), class: "btn btn-ballroom-gold" do %>
            <i class="fas fa-edit me-2"></i>Edit
          <% end %>
          <%= link_to dance_classes_path, class: "btn btn-ballroom-outline" do %>
            <i class="fas fa-arrow-left me-2"></i>Back
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <!-- Main Class Information -->
    <div class="col-lg-8">
      <div class="card card-ballroom mb-4 fade-in">
        <div class="card-header card-header-ballroom">
          <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Class Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <!-- Dance Style & Level -->
            <div class="col-md-6">
              <h6 class="text-muted mb-2">Dance Style & Level</h6>
              <div class="d-flex align-items-center mb-2">
                <span class="badge badge-ballroom me-2"><%= @dance_class.dance_style.name %></span>
                <span class="badge badge-level <%= @dance_class.dance_level.name.downcase.split(' ').first %>">
                  <%= @dance_class.dance_level.name %>
                </span>
              </div>
              <p class="text-muted small mb-0"><%= @dance_class.dance_style.category %></p>
            </div>

            <!-- Class Type -->
            <div class="col-md-6">
              <h6 class="text-muted mb-2">Class Type</h6>
              <div class="fw-bold">
                <i class="fas fa-tag me-2"></i><%= @dance_class.class_type.humanize %>
              </div>
              <% if @dance_class.requires_booking? %>
                <small class="text-info">
                  <i class="fas fa-calendar-check me-1"></i>Advance booking required
                </small>
              <% else %>
                <small class="text-success">
                  <i class="fas fa-door-open me-1"></i>Drop-in welcome
                </small>
              <% end %>
            </div>

            <!-- Instructor -->
            <div class="col-md-6">
              <h6 class="text-muted mb-2">Instructor</h6>
              <div class="d-flex align-items-center">
                <div class="icon-ballroom me-3" style="width: 40px; height: 40px; font-size: 1rem;">
                  <i class="fas fa-user-graduate"></i>
                </div>
                <div>
                  <div class="fw-bold"><%= @dance_class.instructor.full_name %></div>
                  <small class="text-muted"><%= @dance_class.instructor.email %></small>
                </div>
              </div>
            </div>

            <!-- Location -->
            <div class="col-md-6">
              <h6 class="text-muted mb-2">Location</h6>
              <div class="d-flex align-items-center">
                <div class="icon-ballroom me-3" style="width: 40px; height: 40px; font-size: 1rem;">
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <div>
                  <div class="fw-bold"><%= @dance_class.location.name %></div>
                  <small class="text-muted">Capacity: <%= @dance_class.max_capacity %> students</small>
                </div>
              </div>
            </div>

            <!-- Duration & Price -->
            <div class="col-md-6">
              <h6 class="text-muted mb-2">Duration</h6>
              <div class="fw-bold">
                <i class="fas fa-clock me-2"></i><%= @dance_class.duration_formatted %>
              </div>
            </div>

            <div class="col-md-6">
              <h6 class="text-muted mb-2">Price</h6>
              <div class="price-display">
                <span class="currency">$</span><%= @dance_class.price.to_i %>
                <small class="text-muted">per class</small>
              </div>
            </div>
          </div>

          <!-- Description -->
          <% if @dance_class.description.present? %>
            <hr class="my-4">
            <h6 class="text-muted mb-3">Description</h6>
            <p class="mb-0"><%= simple_format(@dance_class.description) %></p>
          <% end %>
        </div>
      </div>

      <!-- Upcoming Schedules -->
      <% if @upcoming_schedules.any? %>
        <div class="card card-ballroom fade-in">
          <div class="card-header card-header-ballroom">
            <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Upcoming Classes</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-ballroom mb-0">
                <thead>
                  <tr>
                    <th>Date & Time</th>
                    <th>Duration</th>
                    <th>Bookings</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @upcoming_schedules.each do |schedule| %>
                    <tr>
                      <td>
                        <div class="fw-bold"><%= schedule.start_datetime.strftime("%B %d, %Y") %></div>
                        <small class="text-muted"><%= schedule.start_datetime.strftime("%l:%M %p") %></small>
                      </td>
                      <td>
                        <span class="badge bg-info">
                          <%= time_duration_in_words(schedule.start_datetime, schedule.end_datetime) %>
                        </span>
                      </td>
                      <td>
                        <% booking_count = schedule.bookings.count %>
                        <div class="progress" style="height: 20px;">
                          <div class="progress-bar bg-success" 
                               style="width: <%= (booking_count.to_f / @dance_class.max_capacity * 100).round %>%">
                            <%= booking_count %>/<%= @dance_class.max_capacity %>
                          </div>
                        </div>
                      </td>
                      <td>
                        <% if schedule.active? %>
                          <span class="badge bg-success">Active</span>
                        <% else %>
                          <span class="badge bg-secondary">Inactive</span>
                        <% end %>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <%= link_to "#", class: "btn btn-sm btn-ballroom-outline" do %>
                            <i class="fas fa-users"></i>
                          <% end %>
                          <%= link_to "#", class: "btn btn-sm btn-ballroom-outline" do %>
                            <i class="fas fa-edit"></i>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Quick Actions -->
      <div class="card card-ballroom mb-4 fade-in">
        <div class="card-header card-header-ballroom">
          <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to "#", class: "btn btn-ballroom-primary" do %>
              <i class="fas fa-calendar-plus me-2"></i>Add Schedule
            <% end %>
            <%= link_to "#", class: "btn btn-ballroom-gold" do %>
              <i class="fas fa-users me-2"></i>View Students
            <% end %>
            <%= link_to "#", class: "btn btn-ballroom-outline" do %>
              <i class="fas fa-chart-bar me-2"></i>View Reports
            <% end %>
          </div>
        </div>
      </div>

      <!-- Class Statistics -->
      <div class="card card-ballroom mb-4 fade-in">
        <div class="card-header card-header-ballroom">
          <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Statistics</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="fw-bold h4 text-primary"><%= @class_schedules.count %></div>
              <small class="text-muted">Total Schedules</small>
            </div>
            <div class="col-6">
              <div class="fw-bold h4 text-success"><%= @upcoming_schedules.count %></div>
              <small class="text-muted">Upcoming Classes</small>
            </div>
          </div>
          <hr>
          <div class="row text-center">
            <div class="col-6">
              <div class="fw-bold h4" style="color: var(--gold);"><%= @dance_class.max_capacity %></div>
              <small class="text-muted">Max Capacity</small>
            </div>
            <div class="col-6">
              <div class="fw-bold h4" style="color: var(--primary-purple);">
                <%= @dance_class.duration_minutes %>m
              </div>
              <small class="text-muted">Duration</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Class -->
      <div class="card card-ballroom border-danger fade-in">
        <div class="card-body text-center">
          <h6 class="text-danger">Danger Zone</h6>
          <%= link_to dance_class_path(@dance_class), method: :delete, 
                    data: { confirm: "Are you sure you want to delete this class? This action cannot be undone." }, 
                    class: "btn btn-outline-danger" do %>
            <i class="fas fa-trash me-2"></i>Delete Class
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>