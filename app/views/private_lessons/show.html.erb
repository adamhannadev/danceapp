<% content_for :title, "Private Lesson Details" %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 text-primary">
          <i class="fas fa-user-graduate me-2"></i>Private Lesson Details
        </h1>
        <div>
          <%= link_to private_lessons_path, class: "btn btn-outline-secondary me-2" do %>
            <i class="fas fa-arrow-left me-1"></i>Back to Lessons
          <% end %>
          
          <% if current_user.admin? || current_user == @private_lesson.instructor || (current_user == @private_lesson.student && @private_lesson.status == 'requested') %>
            <%= link_to edit_private_lesson_path(@private_lesson), class: "btn btn-warning me-2" do %>
              <i class="fas fa-edit me-1"></i>Edit
            <% end %>
          <% end %>
          
          <% if @private_lesson.can_be_confirmed? && (current_user.instructor? || current_user.admin?) %>
            <%= link_to confirm_private_lesson_path(@private_lesson), 
                  method: :patch, 
                  class: "btn btn-success me-2",
                  data: { confirm: "Confirm this lesson?" } do %>
              <i class="fas fa-check me-1"></i>Confirm Lesson
            <% end %>
          <% end %>
          
          <% if @private_lesson.can_be_cancelled? %>
            <%= link_to cancel_private_lesson_path(@private_lesson), 
                  method: :patch, 
                  class: "btn btn-danger",
                  data: { confirm: "Cancel this lesson? This action cannot be undone." } do %>
              <i class="fas fa-times me-1"></i>Cancel Lesson
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="row">
        <!-- Main Lesson Information -->
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0">
                <i class="fas fa-info-circle me-2"></i>Lesson Information
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-bold text-muted">Date & Time</label>
                    <div class="fs-5">
                      <%= @private_lesson.scheduled_at.strftime("%A, %B %d, %Y") %>
                    </div>
                    <div class="text-muted">
                      <%= @private_lesson.scheduled_at.strftime("%I:%M %p") %> - 
                      <%= @private_lesson.end_time.strftime("%I:%M %p") %>
                      (<%= @private_lesson.formatted_duration %>)
                    </div>
                  </div>

                  <!-- Removed dance_style and dance_level display -->

                  <div class="mb-3">
                    <label class="form-label fw-bold text-muted">Location</label>
                    <div class="fs-5"><%= @private_lesson.location.name %></div>
                    <% if @private_lesson.location.address.present? %>
                      <div class="text-muted"><%= @private_lesson.location.address %></div>
                    <% end %>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label fw-bold text-muted">Student</label>
                    <div class="d-flex align-items-center">
                      <div class="avatar-circle bg-light-purple text-white me-3">
                        <%= @private_lesson.student.first_name.first.upcase %>
                      </div>
                      <div>
                        <div class="fs-5"><%= @private_lesson.student.full_name %></div>
                        <div class="text-muted"><%= @private_lesson.student.email %></div>
                        <% if @private_lesson.student.phone.present? %>
                          <div class="text-muted"><%= @private_lesson.student.phone %></div>
                        <% end %>
                      </div>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label class="form-label fw-bold text-muted">Instructor</label>
                    <div class="d-flex align-items-center">
                      <div class="avatar-circle bg-gold text-white me-3">
                        <%= @private_lesson.instructor.first_name.first.upcase %>
                      </div>
                      <div>
                        <div class="fs-5"><%= @private_lesson.instructor.full_name %></div>
                        <div class="text-muted"><%= @private_lesson.instructor.email %></div>
                        <div class="text-muted">$<%= @private_lesson.instructor.hourly_rate %>/hour</div>
                      </div>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label class="form-label fw-bold text-muted">Status</label>
                    <div>
                      <span class="badge bg-<%= @private_lesson.status_color %> fs-6">
                        <%= @private_lesson.status_text %>
                      </span>
                    </div>
                    <% if @private_lesson.confirmed_at.present? %>
                      <small class="text-muted">
                        Confirmed on <%= @private_lesson.confirmed_at.strftime("%B %d, %Y at %I:%M %p") %>
                      </small>
                    <% end %>
                    <% if @private_lesson.cancelled_at.present? %>
                      <small class="text-muted">
                        Cancelled on <%= @private_lesson.cancelled_at.strftime("%B %d, %Y at %I:%M %p") %>
                      </small>
                    <% end %>
                  </div>
                </div>
              </div>

              <% if @private_lesson.notes.present? %>
                <div class="mb-3">
                  <label class="form-label fw-bold text-muted">Notes</label>
                  <div class="border rounded p-3 bg-light">
                    <%= simple_format(@private_lesson.notes) %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Lesson Cost Information -->
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-header bg-success text-white">
              <h5 class="card-title mb-0">
                <i class="fas fa-dollar-sign me-2"></i>Lesson Cost
              </h5>
            </div>
            <div class="card-body">
              <div class="row text-center mb-3">
                <div class="col-12">
                  <div class="fs-2 fw-bold text-primary">$<%= @private_lesson.cost %></div>
                  <small class="text-muted">Total Lesson Cost</small>
                </div>
              </div>

              <% if @private_lesson.student.membership_type != 'none' %>
                <div class="alert alert-info">
                  <i class="fas fa-crown me-2"></i>
                  <strong>Membership Discount Applied</strong><br>
                  <small>
                    <%= @private_lesson.student.membership_type.humanize %> member 
                    (<%= @private_lesson.student.membership_discount %>% off)
                  </small>
                </div>
              <% end %>

              <div class="mt-3">
                <small class="text-muted">
                  <strong>Rate:</strong> $<%= @private_lesson.instructor.hourly_rate %>/hour Ã— 
                  <%= @private_lesson.formatted_duration %>
                </small>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-bolt me-2"></i>Quick Actions
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <% if current_user.admin? || current_user == @private_lesson.instructor %>
                  <%= link_to "#", class: "btn btn-outline-primary" do %>
                    <i class="fas fa-envelope me-1"></i>Send Reminder
                  <% end %>
                  
                  <%= link_to "#", class: "btn btn-outline-info" do %>
                    <i class="fas fa-calendar-plus me-1"></i>Schedule Follow-up
                  <% end %>
                <% end %>
                
                <%= link_to "#", class: "btn btn-outline-secondary" do %>
                  <i class="fas fa-print me-1"></i>Print Details
                <% end %>
                
                <% if current_user.admin? %>
                  <%= link_to @private_lesson, 
                        method: :delete, 
                        class: "btn btn-outline-danger",
                        data: { 
                          confirm: "Are you sure? This will permanently delete this lesson and cannot be undone." 
                        } do %>
                    <i class="fas fa-trash me-1"></i>Delete Lesson
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
