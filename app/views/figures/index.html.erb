<% content_for :title, "Dance Figures Library" %>

<div class="container-fluid">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><%= link_to "Dashboard", dashboard_path %></li>
          <li class="breadcrumb-item active" aria-current="page">Figures</li>
        </ol>
      </nav>
      
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-1">
            <i class="fas fa-music me-2 text-primary"></i>
            Dance Figures Library
          </h1>
          <p class="text-muted mb-0">Manage dance figures and syllabus</p>
        </div>
        
        <div>
          <%= link_to new_figure_path, class: "btn btn-primary me-2" do %>
            <i class="fas fa-plus me-2"></i>Add New Figure
          <% end %>
          <%= link_to import_figures_path, class: "btn btn-outline-secondary" do %>
            <i class="fas fa-upload me-2"></i>Import Figures
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card card-ballroom text-center">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-center">
            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 50px; height: 50px;">
              <i class="fas fa-music text-white"></i>
            </div>
            <div>
              <h5 class="card-title mb-0"><%= @total_figures %></h5>
              <p class="text-muted mb-0">Total Figures</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card card-ballroom text-center">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-center">
            <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 50px; height: 50px;">
              <i class="fas fa-star text-white"></i>
            </div>
            <div>
              <h5 class="card-title mb-0"><%= @core_figures_count %></h5>
              <p class="text-muted mb-0">Core Figures</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card card-ballroom text-center">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-center">
            <div class="bg-info rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 50px; height: 50px;">
              <i class="fas fa-magic text-white"></i>
            </div>
            <div>
              <h5 class="card-title mb-0"><%= @variations_count %></h5>
              <p class="text-muted mb-0">Variations</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card card-ballroom text-center">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-center">
            <div class="bg-warning rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 50px; height: 50px;">
              <i class="fas fa-layer-group text-white"></i>
            </div>
            <div>
              <h5 class="card-title mb-0"><%= DanceStyle.count %></h5>
              <p class="text-muted mb-0">Dance Styles</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card card-ballroom">
        <div class="card-body">
          <%= form_with url: figures_path, method: :get, local: true, class: "row g-3" do |form| %>
            <div class="col-md-3">
              <%= form.text_field :search, 
                  value: params[:search],
                  placeholder: "Search figures...",
                  class: "form-control" %>
            </div>
            
            <div class="col-md-3">
              <%= form.select :dance_style_id, 
                  options_from_collection_for_select(@dance_styles, :id, :name, params[:dance_style_id]),
                  { prompt: "All Dance Styles" },
                  { class: "form-select" } %>
            </div>
            
            <div class="col-md-3">
              <%= form.select :dance_level_id, 
                  options_from_collection_for_select(@dance_levels, :id, :name, params[:dance_level_id]),
                  { prompt: "All Levels" },
                  { class: "form-select" } %>
            </div>
            
            <div class="col-md-3">
              <%= form.select :is_core, 
                  options_for_select([
                    ['All Types', ''],
                    ['Core Figures', 'true'],
                    ['Variations', 'false']
                  ], params[:is_core]),
                  {},
                  { class: "form-select" } %>
            </div>
            
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <div>
                  <%= form.submit "Filter", class: "btn btn-primary me-2" %>
                  <%= link_to "Clear", figures_path, class: "btn btn-outline-secondary" %>
                </div>
                <div class="text-muted">
                  Showing <%= @figures.count %> of <%= @total_figures %> figures
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Figures Table -->
  <div class="row">
    <div class="col-12">
      <div class="card card-ballroom">
        <div class="card-body">
          <% if @figures.any? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Figure #</th>
                    <th>Name</th>
                    <th>Dance Style</th>
                    <th>Level</th>
                    <th>Measures</th>
                    <th>Type</th>
                    <th>Progress</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @figures.each do |figure| %>
                    <tr>
                      <td>
                        <span class="badge bg-secondary"><%= figure.figure_number %></span>
                      </td>
                      <td>
                        <strong><%= link_to figure.name, figure_path(figure), class: "text-decoration-none" %></strong>
                        <% if figure.has_video? %>
                          <i class="fab fa-youtube text-danger ms-2" title="Has video demonstration"></i>
                        <% end %>
                        <% if figure.components.present? %>
                          <br><small class="text-muted"><%= truncate(figure.components, length: 50) %></small>
                        <% end %>
                      </td>
                      <td>
                        <span class="badge bg-secondary">
                          <%= figure.dance_style.name %>
                        </span>
                      </td>
                      <td>
                        <span class="badge <%= dance_level_badge_class(figure.dance_level) %>">
                          <%= figure.dance_level.name %>
                        </span>
                      </td>
                      <td><%= figure.measures %></td>
                      <td>
                        <% if figure.is_core? %>
                          <span class="badge bg-success">
                            <i class="fas fa-star me-1"></i>Core
                          </span>
                        <% else %>
                          <span class="badge bg-info">
                            <i class="fas fa-magic me-1"></i>Variation
                          </span>
                        <% end %>
                      </td>
                      <td>
                        <% progress_count = figure.student_progresses.count %>
                        <% if progress_count > 0 %>
                          <span class="badge bg-primary"><%= progress_count %> students</span>
                        <% else %>
                          <span class="text-muted">No progress</span>
                        <% end %>
                      </td>
                      <td>
                        <div class="btn-group btn-group-sm" role="group">
                          <%= link_to figure_path(figure), class: "btn btn-outline-info btn-sm" do %>
                            <i class="fas fa-eye"></i>
                          <% end %>
                          <%= link_to edit_figure_path(figure), class: "btn btn-outline-warning btn-sm" do %>
                            <i class="fas fa-edit"></i>
                          <% end %>
                          <%= link_to figure_path(figure), 
                              method: :delete,
                              class: "btn btn-outline-danger btn-sm",
                              data: { 
                                confirm: "Are you sure you want to delete this figure?",
                                method: :delete 
                              } do %>
                            <i class="fas fa-trash"></i>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
            
            <!-- Pagination -->
            <% if respond_to?(:paginate) %>
              <div class="d-flex justify-content-center mt-3">
                <%= paginate @figures %>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-5">
              <i class="fas fa-music fa-3x text-muted mb-3"></i>
              <h5 class="text-muted">No figures found</h5>
              <p class="text-muted">Try adjusting your search criteria or add a new figure.</p>
              <%= link_to "Add First Figure", new_figure_path, class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.card-ballroom {
  border: none;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.table th {
  font-weight: 600;
  border-bottom: 2px solid #dee2e6;
}

.badge {
  font-size: 0.75em;
}

/* Dance Level Badge Colors */
.dance-level-bronze-1 {
  background-color: #cd7f32 !important;
  color: white !important;
}

.dance-level-bronze-2 {
  background-color: #b8722c !important;
  color: white !important;
}

.dance-level-bronze-3 {
  background-color: #a36427 !important;
  color: white !important;
}

.dance-level-bronze-4 {
  background-color: #8e5621 !important;
  color: white !important;
}

.dance-level-silver-1 {
  background-color: #c0c0c0 !important;
  color: #333 !important;
}

.dance-level-silver-2 {
  background-color: #b8b8b8 !important;
  color: #333 !important;
}

.dance-level-silver-3 {
  background-color: #a8a8a8 !important;
  color: white !important;
}

.dance-level-silver-4 {
  background-color: #909090 !important;
  color: white !important;
}

.dance-level-gold-1 {
  background-color: #ffd700 !important;
  color: #333 !important;
}

.dance-level-gold-2 {
  background-color: #ffcc00 !important;
  color: #333 !important;
}

.dance-level-gold-3 {
  background-color: #e6b800 !important;
  color: white !important;
}

.dance-level-gold-4 {
  background-color: #cc9900 !important;
  color: white !important;
}

.btn-group-sm .btn {
  padding: 0.25rem 0.5rem;
}
</style>
